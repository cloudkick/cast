#!/bin/env
var net = require("net");
var path = require("path");

var svcname = path.basename(__dirname);
var socketpath = path.normalize(path.join(__dirname, '..', '..', 'test-data'));
var stream = net.createConnection(socketpath);

stream.setEncoding('ascii');

stream.on('connect', function() {
  var received = "";
  stream.setEncoding('ascii');
      
  function report(signal) {
    stream.write(svcname + ':' + signal + '\n');
  }

  // Report that we are running
  report('STARTED');

  // Report signals when they are received
  process.on('SIGTERM', report('SIGTERM'));
  process.on('SIGCONT', report('SIGCONT'));

  // Exit on command
  stream.on('data', function(data) {
    received += data;
    if (received.match(/EXIT/)) {
      process.exit(0);
    }
    else {
      received = received.slice(-3);
    }
  });
});

process.exit();
